<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaka Tea Stall ‚Äî Self Order & Billing</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
body{
 margin:0;
 font-family:'Poppins',sans-serif;
 background:#fff6ed;
 color:#222;
}

/* ===== HEADER ===== */
.top-header{
 background:linear-gradient(135deg,#3e0000,#8b0000,#d97706);
 color:white;
 padding:16px;
 text-align:center;
 font-size:20px;
 font-weight:700;
 letter-spacing:0.5px;
 box-shadow:0 6px 15px rgba(0,0,0,0.3);
 position:sticky;
 top:0;
 z-index:50;
}

/* ===== ITEM LIST ===== */
.section{ padding:18px; }

.item-card{
 background:white;
 border-radius:18px;
 padding:12px;
 margin-bottom:12px;
 box-shadow:0 5px 14px rgba(0,0,0,0.10);
 display:flex;
 align-items:center;
 justify-content:space-between;
 gap:10px;
}

.item-left{
 display:flex;
 align-items:center;
 gap:10px;
}

.item-left img{
 width:65px;
 height:65px;
 border-radius:12px;
 object-fit:cover;
 background:#eee;
}

.item-info b{ font-size:14px; font-weight:600; }
.item-info small{ font-size:12px; color:#777; }

/* ===== QTY ===== */
.qty{ display:flex; align-items:center; gap:6px; }

.qty button{
 background:#ffb300;
 border:none;
 border-radius:6px;
 width:28px;
 height:28px;
 font-weight:bold;
 font-size:15px;
 box-shadow:0 2px 6px rgba(0,0,0,0.2);
}

/* ===== CART BAR ===== */
.cart-bar{
 position:fixed;
 bottom:0;
 left:0;
 right:0;
 background:linear-gradient(135deg,#3e0000,#8b0000);
 color:white;
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:10px 16px;
 box-shadow:0 -4px 12px rgba(0,0,0,0.35);
 z-index:40;
}

.cart-bar button{
 background:#ffb300;
 border:none;
 padding:7px 18px;
 border-radius:25px;
 font-weight:700;
 box-shadow:0 3px 8px rgba(0,0,0,0.3);
}

/* ===== BILL ===== */
.hidden{display:none;}

.bill-wrap{ padding:20px; }

.bill-card{
 background:white;
 border-radius:20px;
 padding:20px;
 box-shadow:0 6px 18px rgba(0,0,0,0.18);
 text-align:center;
}

/* ===== BILL HEADER ===== */
.bill-logo{
 width:60px;
 height:60px;
 border-radius:14px;
 background:#ffb300;
 display:inline-flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
 font-weight:bold;
 margin-bottom:6px;
 box-shadow:0 4px 10px rgba(0,0,0,0.3);
}

.bill-title{ font-size:20px; font-weight:700; color:#7b1113; }
.bill-sub{ font-size:12px; color:#666; margin-bottom:8px; }

.line{ border-top:1px dashed #aaa; margin:10px 0; }

/* ===== BILL ITEMS ===== */
.bill-items{ font-size:13px; text-align:left; line-height:1.9; margin-top:6px; }

.bill-items div{
 display:flex;
 justify-content:space-between;
 border-bottom:1px dotted #ddd;
 padding:4px 0;
}

/* ===== TOTAL ===== */
.total{ font-size:18px; font-weight:700; margin:10px 0; }

/* ===== QR ===== */
.qr-box{
 display:inline-block;
 padding:10px;
 border:2px solid #ffb300;
 border-radius:16px;
 margin:10px 0;
}

.qr-box div{ font-size:12px; margin-bottom:6px; }

/* ===== BUTTONS ===== */
.primary-btn{
 background:linear-gradient(135deg,#ffd36a,#ffb300);
 border:none;
 padding:10px 20px;
 border-radius:30px;
 font-weight:700;
 font-size:14px;
 margin:6px;
 box-shadow:0 4px 10px rgba(0,0,0,0.25);
}

.primary-btn:active{ transform:scale(0.97); }

.footer-note{
 font-size:11px;
 color:#666;
 margin-top:10px;
 line-height:1.5;
}
</style>
</head>

<body>

<a href="index.html" style="text-decoration:none; color:white;">
  <div class="top-header">
    ‚òï Kaka Tea Stall ‚Äî Self Order
  </div>
</a>

<!-- ===== ITEM LIST ===== -->
<div class="section" id="shop">
<div id="itemList"></div>
</div>

<!-- ===== CART BAR ===== -->
<div class="cart-bar" id="cartBar">
<div>Total ‚Çπ <span id="cartTotal">0</span></div>
<button onclick="generateBill()">Generate Bill</button>
</div>

<!-- ===== BILL BOX ===== -->
<div id="billBox" class="hidden">
 <div class="bill-wrap">
  <div class="bill-card">

    <div class="bill-logo">‚òï</div>
    <div class="bill-title">Kaka Tea Stall</div>
    <div class="bill-sub">Digital Payment Invoice</div>

    <div class="line"></div>

    <div><b>Bill No:</b> <span id="billNo"></span></div>
    <div id="billDate" style="font-size:12px;color:#666;"></div>

    <div class="line"></div>

    <div class="bill-items" id="billItems"></div>

    <div class="line"></div>

    <div class="total">Total ‚Çπ <span id="billTotal"></span></div>

    <div class="qr-box" id="qrSection">
      <div>Scan & Pay using any UPI App</div>
      <img id="qr" width="220">
    </div>

    <div class="line"></div>

    <button class="primary-btn" id="upiBtn" onclick="openUPI()">üí≥ Open UPI App & Pay Now</button>

    <div class="footer-note">
      ‚ö†Ô∏è Payment complete hone ke baad.<br>
      Screenshot upload karna zaruri hai.
    </div>

    <a href="https://forms.gle/ntDaekagEsrvXo7H7" target="_blank">
      <button class="primary-btn">üì§ Upload Payment Screenshot</button>
    </a>

    <button class="primary-btn" id="waBtn" onclick="shareWhatsApp()">üì§ Share Bill on WhatsApp</button>

    <button class="primary-btn" onclick="location.reload()">‚¨Ö New Order</button>

  </div>
 </div>
</div>

<script>

/* ===== LOAD ITEMS ===== */
let items = JSON.parse(localStorage.getItem("itemsDB")) || [
 {name:"Regular Chai",price:5,img:"https://i.imgur.com/Fk7V4ks.jpg"},
 {name:"Masala Chai",price:25,img:"https://i.imgur.com/0q9Z1Zm.jpg"},
 {name:"Special Chai",price:15,img:"https://i.imgur.com/7yUvePI.jpg"},
 {name:"Simple Bhojan Plate",price:60,img:"https://i.imgur.com/1JQJg9S.jpg"}
];

let cart = new Array(items.length).fill(0);

/* ===== ADMIN TOGGLES ===== */
let upiSystem   = localStorage.getItem("upiSystem") !== "false";
let waSystem    = localStorage.getItem("waSystem") !== "false";
let directUpi   = localStorage.getItem("directUpi") !== "false";
let payPageSys  = localStorage.getItem("payPage") !== "false";

/* ===== GLOBAL ===== */
let upiLink="";
let totalAmount=0;

/* ===== RENDER MENU ===== */
function renderMenu(){
 let html="";
 items.forEach((it,i)=>{
 html+=`
 <div class="item-card">
   <div class="item-left">
     <img src="${it.img}">
     <div class="item-info">
       <b>${it.name}</b><br>
       <small>‚Çπ${it.price}</small>
     </div>
   </div>
   <div class="qty">
     <button onclick="changeQty(${i},-1)">‚àí</button>
     <span id="q${i}">${cart[i]}</span>
     <button onclick="changeQty(${i},1)">+</button>
   </div>
 </div>
 `;
 });
 itemList.innerHTML=html;
}
renderMenu();

function changeQty(i,v){
 cart[i]+=v;
 if(cart[i]<0) cart[i]=0;
 document.getElementById("q"+i).innerText=cart[i];
 updateTotal();
}

function updateTotal(){
 let t=0;
 cart.forEach((c,i)=>{ t+=c*items[i].price; });
 cartTotal.innerText=t;
}

/* ===== GENERATE BILL ===== */
function generateBill(){
 totalAmount = cartTotal.innerText;
 if(totalAmount==0){ alert("Please select items"); return; }

 let bill="KAKA"+Date.now();
 billNo.innerText=bill;
 billTotal.innerText=totalAmount;
 billDate.innerText=new Date().toLocaleString();

 let listHTML="";
 let listText="";

 cart.forEach((c,i)=>{
  if(c>0){
   listHTML+=`
   <div>
     <span>${items[i].name} √ó ${c}</span>
     <span>‚Çπ${c*items[i].price}</span>
   </div>`;
   listText += "‚Ä¢ "+items[i].name+" √ó "+c+" = ‚Çπ"+(c*items[i].price)+"\n";
  }
 });

 billItems.innerHTML=listHTML;

 upiLink="upi://pay?pa=paytmqr6z5isw@ptys&pn=KakaTeaStall&am="+totalAmount+"&cu=INR&tn=Bill-"+bill;

 if(upiSystem){
   qr.src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data="+encodeURIComponent(upiLink);
 }

 upiBtn.style.display = (directUpi && upiSystem) ? "inline-block" : "none";
 waBtn.style.display = waSystem ? "inline-block" : "none";

 shop.classList.add("hidden");
 cartBar.classList.add("hidden");
 billBox.classList.remove("hidden");

 window.itemListText = listText;
}

/* ===== DIRECT UPI ===== */
function openUPI(){
 if(upiLink!=""){ location.href=upiLink; }
}

/* ===== FINAL WHATSAPP MESSAGE WITH ADMIN CONTROL ===== */
function shareWhatsApp(){
 let bill = billNo.innerText;
 let now  = new Date().toLocaleString();

 let payNowPage =
 "https://djjeenal.github.io/Maheshpadhiyar/pay.html?bill="+bill+"&amt="+totalAmount;

 let msg =
"‚òï *KAKA TEA STALL*\n"+
"*Digital Payment Invoice*\n\n"+
"üßæ *Bill No:* "+bill+"\n"+
"‚è∞ *Date & Time:* "+now+"\n\n"+
"üìã *Items Ordered:*\n"+window.itemListText+"\n"+
"üí∞ *Total Amount:* ‚Çπ"+totalAmount+"\n\n";

 if(directUpi){
   msg += "üì≤ *Direct UPI Pay Link:*\n"+upiLink+"\n\n";
 }

 if(payPageSys){
   msg += "üåê *Pay Now Page:*\n"+payNowPage+"\n\n";
 }

 msg +=
"üì§ *Upload Screenshot:*\nhttps://forms.gle/ntDaekagEsrvXo7H7\n\n"+
"‚ö†Ô∏è Payment ke baad screenshot upload karna zaruri hai.";

 window.open("https://wa.me/?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>